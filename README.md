# 图像分析工作流

该项目实现了一个基于 LangGraph 和 Ollama 的图像分析工作流。用户可以提供图像及需求，系统会根据用户的需求自动选择合适的分析任务，并进行图像处理、推理与输出。

## 目录

- [项目简介](#项目简介)
- [系统要求](#系统要求)
- [安装依赖](#安装依赖)
- [工作流程概述](#工作流程概述)
- [使用方法](#使用方法)
- [常见问题](#常见问题)

## 项目简介

这个图像分析工作流通过 LangGraph 编排了不同的处理步骤，包括图像输入、预处理、模型选择、推理、输出等。每个步骤的处理都包含错误处理机制，确保系统在面对不同输入时能够智能响应。

工作流的主要功能如下：

1. **需求分析**：根据用户输入的需求，自动判断任务类型（分类、标注或图像描述）。
2. **图像输入**：支持加载用户指定路径的图像。
3. **图像预处理**：根据任务类型进行相应的预处理。
4. **模型选择**：自动选择适合任务的模型，如 ResNet50（分类）、YOLOv5（标注）、LLaVA-13B（图像描述）。
5. **推理**：使用选定的模型进行推理，并输出结果。
6. **结果输出**：根据任务类型输出分类结果、注释图像或图像描述。

## 系统要求

- Python 3.13
- 安装依赖

## 安装依赖

首先，确保您的 Python 环境中已安装以下依赖：

```bash
pip install -r requirements.txt
```

## 工作流程概述

图像分析工作流由以下几个关键步骤构成：

1. **分析节点（analysis_node）**：根据用户需求分析任务类型（分类、标注、描述），并返回分析结果。
2. **图像输入节点（image_input_node）**：加载用户指定的图像文件。
3. **图像预处理节点（preprocess_node）**：根据任务类型对图像进行预处理。
4. **模型选择节点（model_selection_node）**：选择合适的模型（ResNet50、YOLOv5、LLaVA-13B）。
5. **推理节点（inference_node）**：执行推理，得到分类结果、标注结果或图像描述。
6. **结果输出节点（output_node）**：根据任务输出相应的结果，包括分类结果、注释图像或图像描述。
7. **错误处理节点（error_handler_node）**：当发生错误时，进行错误处理并恢复工作流程。

每个节点会根据其处理的结果更新状态，并通过 LangGraph 的条件路由决策（如是否重试）来决定下一步操作。

## 使用方法

1. **启动项目**：
   ```bash
   python Test2.py
   ```
2. **输入需求**：

   用户需提供对图像的描述性需求，例如：
   - **分类**：识别图像中的主要对象或类别（例如：“这是什么动物？”）。
   - **标注**：检测并定位图像中的多个对象（例如：“找出所有物体及其位置”）。
   - **解释**：提供图像的详细描述（例如：“描述图像中发生的事情”）。

   示例：
   ```text
   请输入您的图像分析需求：找出所有物体及其位置
   ```

3. **处理与输出**：

   根据输入需求，系统会自动完成图像的分析、处理和输出，并显示最终结果。

   - 对于分类任务，输出类别名称。
   - 对于标注任务，生成带标注的图像，并输出检测到的物体。
   - 对于解释任务，提供图像的详细描述。

4. **错误处理**：

   如果工作流中的任何节点发生错误，系统会自动恢复并使用默认任务进行处理。

## 常见问题

1. **无法读取图像**：
   确保提供的图像路径正确，且图像文件格式支持（如 .jpg、.png）。

2. **任务无法识别**：
   如果用户输入的需求无法被分析模型识别为有效任务，请确保需求描述清晰，并符合分类、标注或描述的类型。

3. **模型推理错误**：
   如果在推理过程中遇到错误，系统会自动进入错误处理流程并恢复工作。
